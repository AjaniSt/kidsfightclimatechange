<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.1.1/chartjs-plugin-zoom.min.js"></script>
</head>
<body onLoad="ready()">
<canvas id="myChart" width="250" height="200"></canvas>
<script>
    const chart_watermark = {
        id: 'chart_watermark',
        afterDraw: (chart) => {
            const image = new Image();
                image.src = 'https://static.wixstatic.com/media/6281d3_fa0bf3ebac21475ebbdd6dec7892e01f~mv2.png';
            if (image.complete) {
                const image_height = 42;
                const image_width = 42;
                const ctx = chart.ctx;
                const x = 5;
                const y = chart.chartArea.height - 5;
                ctx.drawImage(image, x, y, image_width, image_height);
            } else {
                image.onload = () => chart.draw();
            }
        }
    }
    Chart.register(chart_watermark)
    var ctx = document.getElementById("myChart");
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [1880,
    1881,
    1882,
    1883,
    1884,
    1885,
    1886,
    1887,
    1888,
    1889,
    1890,
    1891,
    1892,
    1893,
    1894,
    1895,
    1896,
    1897,
    1898,
    1899,
    1900,
    1901,
    1902,
    1903,
    1904,
    1905,
    1906,
    1907,
    1908,
    1909,
    1910,
    1911,
    1912,
    1913,
    1914,
    1915,
    1916,
    1917,
    1918,
    1919,
    1920,
    1921,
    1922,
    1923,
    1924,
    1925,
    1926,
    1927,
    1928,
    1929,
    1930,
    1931,
    1932,
    1933,
    1934,
    1935,
    1936,
    1937,
    1938,
    1939,
    1940,
    1941,
    1942,
    1943,
    1944,
    1945,
    1946,
    1947,
    1948,
    1949,
    1950,
    1951,
    1952,
    1953,
    1954,
    1955,
    1956,
    1957,
    1958,
    1959,
    1960,
    1961,
    1962,
    1963,
    1964,
    1965,
    1966,
    1967,
    1968,
    1969,
    1970,
    1971,
    1972,
    1973,
    1974,
    1975,
    1976,
    1977,
    1978,
    1979,
    1980,
    1981,
    1982,
    1983,
    1984,
    1985,
    1986,
    1987,
    1988,
    1989,
    1990,
    1991,
    1992,
    1993,
    1994,
    1995,
    1996,
    1997,
    1998,
    1999,
    2000,
    2001,
    2002,
    2003,
    2004,
    2005,
    2006,
    2007,
    2008,
    2009,
    2010,
    2011,
    2012,
    2013,
    2014,
    2015,
    2016,
    2017,
    2018,
    2019,
    2020,
    ],
          datasets: [{
            label: 'Temperature Anomaly',
            data: [-0.16,
    -0.08,
    -0.1,
    -0.17,
    -0.28,
    -0.33,
    -0.31,
    -0.36,
    -0.17,
    -0.1,
    -0.35,
    -0.22,
    -0.27,
    -0.31,
    -0.3,
    -0.23,
    -0.11,
    -0.11,
    -0.27,
    -0.18,
    -0.08,
    -0.15,
    -0.28,
    -0.37,
    -0.47,
    -0.26,
    -0.22,
    -0.39,
    -0.43,
    -0.48,
    -0.44,
    -0.44,
    -0.36,
    -0.34,
    -0.15,
    -0.14,
    -0.36,
    -0.46,
    -0.3,
    -0.28,
    -0.28,
    -0.19,
    -0.29,
    -0.27,
    -0.27,
    -0.22,
    -0.11,
    -0.22,
    -0.2,
    -0.36,
    -0.16,
    -0.09,
    -0.16,
    -0.29,
    -0.13,
    -0.2,
    -0.15,
    -0.03,
    0,
    -0.02,
    0.13,
    0.19,
    0.07,
    0.09,
    0.2,
    0.09,
    -0.07,
    -0.03,
    -0.11,
    -0.11,
    -0.17,
    -0.07,
    0.01,
    0.08,
    -0.13,
    -0.14,
    -0.19,
    0.05,
    0.06,
    0.03,
    -0.03,
    0.06,
    0.03,
    0.05,
    -0.2,
    -0.11,
    -0.06,
    -0.02,
    -0.08,
    0.05,
    0.03,
    -0.08,
    0.01,
    0.16,
    -0.07,
    -0.01,
    -0.1,
    0.18,
    0.07,
    0.16,
    0.26,
    0.32,
    0.14,
    0.31,
    0.16,
    0.12,
    0.18,
    0.32,
    0.39,
    0.27,
    0.45,
    0.41,
    0.22,
    0.23,
    0.32,
    0.45,
    0.33,
    0.46,
    0.61,
    0.38,
    0.4,
    0.54,
    0.63,
    0.62,
    0.54,
    0.68,
    0.64,
    0.67,
    0.54,
    0.66,
    0.72,
    0.61,
    0.65,
    0.68,
    0.75,
    0.9,
    1.02,
    0.92,
    0.85,
    0.98,
    1.02
    ],
    fill: true,
            backgroundColor: [
              'rgba(10, 168, 196, 0.2)',
              'rgba(102, 96, 151, 0.2)',
              'rgba(57, 87, 255, 0.2)',
              'rgba(233, 182, 233, 0.2)',
              'rgba(108, 213, 207, 0.2)',
              'rgba(125, 178, 230, 0.2)'
            ],
            borderColor: [
              'rgba(10, 168, 196, 1)',
              'rgba(102, 96, 151, 1)',
              'rgba(57, 87, 255, 1)',
              'rgba(233, 182, 233, 1)',
              'rgba(108, 213, 207, 1)',
              'rgba(125, 178, 230, 1)'
            ],
            borderWidth: 1,
    pointRadius: 3,
    pointHitRadius: 8
          }]
        },
        options: {
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true,
                 callback: function(value, index, values) {
                   return value + 'Â°C';
                 }
              },
              titles: {
                display: true,
                text: 'Test'
              }
            }],
            xAxes: [{
              ticks: {
                    maxTicksLimit: 15
                }
              }]
          },
          plugins:{
            legend: {display: false},
            zoom: {
                zoom: {
                  wheel: {
                    enabled: true,
                    speed: 0.05
                  },
                  pinch: {
                    enabled: true
                  },
                  mode: 'xy',
                },
                limits: {
                  y: {min: -2, max: 2}
                }
          }
    },
          onClick: handleClick
        }
      });

      window.onmessage = function(event){

        if (event.data && Array.isArray(event.data)) {
          myChart.data.datasets[0].data = event.data;
          myChart.update();
        }
        else {
          console.log("HTML Code Element received a generic message:");
          console.log(event.data);
        }
      };

      function handleClick(e){
        var activeBars = myChart.getElementAtEvent(e);

        var value = myChart.config.data.datasets[activeBars[0]._datasetIndex].data[activeBars[0]._index];
        var label = activeBars[0]._model.label;

        window.parent.postMessage({
          "type":"click",
          "label":label,
          "value":value
        } , "*");
      }

      function ready(){
        window.parent.postMessage({"type":"ready"}, "*");
      }

    </script>

    </body>
    </html>
