<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ocean Heat Levels 1957-2018</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.1.1/chartjs-plugin-zoom.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@600&display=swap" rel="stylesheet">
</head>
<body onLoad="ready()">
<canvas id="myChart" width="250" height="200"></canvas>

<script>

    const chart_watermark = {
        id: 'chart_watermark',
        afterDraw: (chart) => {
            const image = new Image();
                image.src = 'https://static.wixstatic.com/media/6281d3_19b5d40c9896439494b2a8a8f8eb37ea~mv2.png';
            if (image.complete) {
                const image_width = 0.05*chart.chartArea.width;
                const image_height = image_width * (image.naturalHeight / image.naturalWidth);
                console.log('image: ', image_width, image_height)
                console.log('chart: ', chart.chartArea.width, chart.chartArea.height)
                const ctx = chart.ctx;
                const x = chart.chartArea.width + 10;
                const y = chart.chartArea.height - image_height;
                ctx.drawImage(image, x, y, image_width, image_height);
            } else {
                image.onload = () => chart.draw();
            }
        }
    }
    Chart.register(chart_watermark)
    Chart.defaults.font.family = 'Lato', 'sans-serif';
    var ctx = document.getElementById("myChart");
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [1957,
    1958,
    1959,
    1960,
    1961,
    1962,
    1963,
    1964,
    1965,
    1966,
    1967,
    1968,
    1969,
    1970,
    1971,
    1972,
    1973,
    1974,
    1975,
    1976,
    1977,
    1978,
    1979,
    1980,
    1981,
    1982,
    1983,
    1984,
    1985,
    1986,
    1987,
    1988,
    1989,
    1990,
    1991,
    1992,
    1993,
    1994,
    1995,
    1996,
    1997,
    1998,
    1999,
    2000,
    2001,
    2002,
    2003,
    2004,
    2005,
    2006,
    2007,
    2008,
    2009,
    2010,
    2011,
    2012,
    2013,
    2014,
    2015,
    2016,
    2017,
    2018,
    ],
          datasets: [{
            label: 'Ocean Heat',
            data: [-9.303,-8.059,-8.713,-5.479,-4.762,-4.121,-5.697,-6.521,-7.218,-9.122,-9.059,-8.991,-7.620,-6.838,-5.627,-4.770,-4.087,-3.354,-1.398,-1.445,-1.143,0.056,0.068,-1.176,-1.383,-1.073,-0.974,-0.210,0.481,0.718,1.023,0.844,0.412,0.517,3.036,3.899,3.840,3.409,4.543,5.033,4.996,6.233,6.234,7.286,8.284,9.481,10.173,11.806,11.996,12.423,12.664,14.102,14.587,15.229,16.681,17.563,19.004,20.001,21.074,21.879,22.147,23.294,],
            fill: true,
            backgroundColor: [
              'rgba(10, 168, 196, 0.2)',
              'rgba(102, 96, 151, 0.2)',
              'rgba(57, 87, 255, 0.2)',
              'rgba(233, 182, 233, 0.2)',
              'rgba(108, 213, 207, 0.2)',
              'rgba(125, 178, 230, 0.2)'
            ],
            borderColor: [
              'rgba(10, 168, 196, 1)',
              'rgba(102, 96, 151, 1)',
              'rgba(57, 87, 255, 1)',
              'rgba(233, 182, 233, 1)',
              'rgba(108, 213, 207, 1)',
              'rgba(125, 178, 230, 1)'
            ],
            borderWidth: 1,
    pointRadius: 3,
    pointHitRadius: 8
          }]
        },
        options: {
          scales: {
            y: {
              ticks: {
                beginAtZero: true,
                 callback: function(value, index, values) {
                   return value + ' ZJ';
                 }
              },
              title: {
                display: true,
                text: 'Ocean Heat Levels (zettajoules)',
                font: {
                  size: 15,
                  family: 'Raleway'
                }
              }
            },
            x: {
              ticks: {
                    maxTicksLimit: 15
                }
              }
          },
          plugins:{
            legend: {display: false},
            zoom: {
                zoom: {
                  wheel: {
                    enabled: true,
                    speed: 0.05
                  },
                  pinch: {
                    enabled: true
                  },
                  mode: 'xy',
                },
                limits: {
                  y: {min: -10, max: 25}
                }
          }
    },
          onClick: handleClick
        }
      });

      window.onmessage = function(event){

        if (event.data && Array.isArray(event.data)) {
          myChart.data.datasets[0].data = event.data;
          myChart.update();
        }
        else {
          console.log("HTML Code Element received a generic message:");
          console.log(event.data);
        }
      };

      function handleClick(e){
        var activeBars = myChart.getElementAtEvent(e);

        var value = myChart.config.data.datasets[activeBars[0]._datasetIndex].data[activeBars[0]._index];
        var label = activeBars[0]._model.label;

        window.parent.postMessage({
          "type":"click",
          "label":label,
          "value":value
        } , "*");
      }

      function ready(){
        window.parent.postMessage({"type":"ready"}, "*");
      }

    </script>

    </body>
</html>
